#!/bin/bash

# check if javabox exists and is on the PATH
JAVABOX_VER=$(javabox --version)
if test -z "$JAVABOX_VER"; then
  JAVABOX_BIN_URL="https://dist.origis.info/javabox/shapshot/javabox"
  JAVABOX_BIN="/tmp/javabox"
  # use `curl` or `wget` to download the wrapper
  if command -v wget > /dev/null; then
    echo "Using wget"
    wget "$JAVABOX_BIN_URL" -O "$JAVABOX_BIN" || exit 1
  elif command -v curl > /dev/null; then
    echo "Using curl"
    curl "$JAVABOX_BIN_URL" -o "$JAVABOX_BIN" --fail -L || exit 1
  else
    echo "ERROR: Neither 'curl' nor 'wget' is installed" >&2
    exit 1
  fi
  # setup:
  # - moves itself to a target dir
  # - creates symlinks (somewhere?) on PATH
  chmod +x $JAVABOX_BIN
  $JAVABOX_BIN install
  cat >>~/.bashrc << \EOF
export PATH=$HOME/bin:$PATH
echo "PATH: $PATH"
EOF
  source ~/.bashrc
  export PATH=$HOME/bin:$PATH
  echo "PATH now: $PATH"
fi

exec mvn "$@"
